<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éš¨æ©Ÿäº¤æ›ç¦®ç‰©æŠ½ç±¤ç¨‹å¼</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }
        #participants, #results {
            width: 80%;
            max-width: 600px;
            margin: 20px auto;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            text-align: left;
        }
        #participants textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result-item {
            margin-bottom: 5px;
            padding: 5px;
            border-bottom: 1px dashed #eee;
        }
    </style>
</head>
<body>

    <h1>ğŸ„ è–èª•äº¤æ›ç¦®ç‰©æŠ½ç±¤</h1>

    <div id="participants">
        <h2>1. è¼¸å…¥åƒèˆ‡è€…åå–®</h2>
        <p>è«‹æ¯è¡Œè¼¸å…¥ä¸€å€‹åå­—ï¼š</p>
        <textarea id="nameList">
1
2
3
4
5
6
        </textarea>
    </div>

    <button onclick="drawNames()">é–‹å§‹æŠ½ç±¤ï¼</button>
    <button onclick="resetResults()">é‡è¨­çµæœ</button>

    <div id="results">
        <h2>2. æŠ½ç±¤çµæœ</h2>
        <div id="resultOutput">
            <p>é»æ“Š "é–‹å§‹æŠ½ç±¤ï¼" æŒ‰éˆ•é€²è¡Œé…å°ã€‚</p>
        </div>
    </div>

    <script>
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;

            // While there remain elements to shuffle.
            while (currentIndex != 0) {
                // Pick a remaining element.
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;

                // And swap it with the current element.
                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }

            return array;
        }

        function drawNames() {
            // å–å¾—åå–®ä¸¦å»é™¤ç©ºç™½è¡Œ
            const nameListText = document.getElementById('nameList').value;
            let participants = nameListText.split('\n')
                                            .map(name => name.trim())
                                            .filter(name => name.length > 0);

            const resultOutput = document.getElementById('resultOutput');
            resultOutput.innerHTML = ''; // æ¸…é™¤èˆŠçµæœ

            if (participants.length < 2) {
                resultOutput.innerHTML = '<p style="color: red;">è‡³å°‘éœ€è¦å…©ä½åƒèˆ‡è€…æ‰èƒ½é€²è¡ŒæŠ½ç±¤ï¼</p>';
                return;
            }

            // è¤‡è£½åå–®ï¼Œä½œç‚ºã€Œæ”¶ç¦®è€…ã€åå–®
            let receivers = [...participants];

            // éš¨æ©Ÿæ‰“äº‚æ”¶ç¦®è€…åå–®
            receivers = shuffle(receivers);

            // ç¢ºä¿æ²’æœ‰äººæŠ½åˆ°è‡ªå·± (A -> A)
            let maxAttempts = 100; // é¿å…ç„¡é™è¿´åœˆ
            let attempt = 0;
            let selfDrawExists = true;

            while (selfDrawExists && attempt < maxAttempts) {
                selfDrawExists = false;
                for (let i = 0; i < participants.length; i++) {
                    if (participants[i] === receivers[i]) {
                        selfDrawExists = true;
                        // ç°¡å–®çš„è§£æ±ºæ–¹æ³•ï¼šèˆ‡ä¸‹ä¸€å€‹æ”¶ç¦®è€…äº¤æ›ï¼ˆå¦‚æœæ˜¯æœ€å¾Œä¸€å€‹å°±èˆ‡ç¬¬ä¸€å€‹äº¤æ›ï¼‰
                        let nextIndex = (i + 1) % participants.length;
                        [receivers[i], receivers[nextIndex]] = [receivers[nextIndex], receivers[i]];
                        break; // é‡æ–°æª¢æŸ¥æ‰€æœ‰é…å°
                    }
                }
                if (selfDrawExists) {
                    // å¦‚æœäº¤æ›å¾Œé‚„æ˜¯æœ‰äººæŠ½åˆ°è‡ªå·±ï¼Œå°±ç›´æ¥é‡æ–°æ‰“äº‚
                    receivers = shuffle(receivers); 
                }
                attempt++;
            }

            // é¡¯ç¤ºçµæœ
            if (attempt === maxAttempts) {
                resultOutput.innerHTML = '<p style="color: orange;">ç„¡æ³•åœ¨é™å®šæ¬¡æ•¸å…§æ‰¾åˆ°ç„¡äººæŠ½åˆ°è‡ªå·±çš„å®Œç¾é…å°ï¼Œè«‹é‡è©¦ã€‚</p>';
                return;
            }

            for (let i = 0; i < participants.length; i++) {
                const giver = participants[i];
                const receiver = receivers[i];

                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                // ç‚ºäº†ä¿è­·éš±ç§ï¼Œä½ å¯ä»¥è®“ä½¿ç”¨è€…åªçœ‹è‡ªå·±çš„çµæœã€‚é€™è£¡å…ˆå…¨éƒ¨é¡¯ç¤ºã€‚
                resultItem.innerHTML = `<strong>${giver}</strong> å°‡ç¦®ç‰©é€çµ¦ â†’ <span style="color: blue; font-weight: bold;">${receiver}</span>`;
                resultOutput.appendChild(resultItem);
            }
        }

        function resetResults() {
            document.getElementById('resultOutput').innerHTML = '<p>é»æ“Š "é–‹å§‹æŠ½ç±¤ï¼" æŒ‰éˆ•é€²è¡Œé…å°ã€‚</p>';
        }

        // åˆå§‹åŒ–æ™‚è‡ªå‹•æ¸…é™¤ textarea å·¦å³çš„ç©ºç™½
        document.addEventListener('DOMContentLoaded', () => {
            const textarea = document.getElementById('nameList');
            textarea.value = textarea.value.trim();
        });

    </script>

</body>
</html>